/*!
 * jquery-file-upload v1.0beta (https://github.com/honguangli/jquery-file-upload)
 * Copyright honguangli
 * Licensed under the MIT license
 */
(function(a){"use strict";function b(a,b){const c=this;c.element=a,c.init(b)}const c="choose",d="upload",e="push",f="info",g="error",h=0,i=1,j=2,k=200,l=500,m={multiple:!1,limit:1,maxSize:1024e3,accept:"image/*",acceptMime:"image/*",exts:"jpg|png|gif|bmp|jpeg",auto:!0,url:"",headers:{},param:{},download:!1,bindElem:null,data:[],"list-type":"text",subscribeMessage:"info|warn|error",msg:{limit:"\u6700\u591A\u53EF\u9009\u62E9{limit}\u5F20\u56FE\u7247",maxSize:"\u6587\u4EF6\u5927\u5C0F\u8D85\u51FA"},controls:{hide:!1,choose:!0,"choose-style":"btn-primary btn-mini","choose-content":"<i class=\"fa fa-cloud-upload fa-fw\"></i> \u9009\u62E9\u6587\u4EF6",display:!1,"display-style":"btn-primary btn-mini","display-hide-content":"<i class=\"fa fa-eye-slash fa-fw\"></i>","display-show-content":"<i class=\"fa fa-eye fa-fw\"></i>","upload-multiple":!1,"upload-multiple-style":"btn-primary btn-mini","upload-multiple-content":"<i class=\"fa fa-cloud-upload fa-fw\"></i>",clear:!1,"clear-style":"btn-danger btn-mini","clear-content":"<i class=\"fa fa-trash fa-fw\"></i>",full:!1,upload:!0,"upload-style":"","upload-content":"<i class=\"fa fa-cloud-upload fa-fw\"></i>",remove:!0,"remove-style":"","remove-content":"<i class=\"fa fa-trash fa-fw\"></i>",preview:!1,"preview-style":"","preview-content":"<i class=\"fa fa-search-plus fa-fw\"></i>","picture-choose":!1,"picture-choose-style":"","picture-choose-content":"<i class=\"fa fa-plus fa-fw\"></i>","picture-choose-content-list":[]},icon:{"default-icon":"<i class=\"fa fa-exclamation-circle fa-fw\"></i>","uploading-icon":"<i class=\"fa fa-spinner fa-fw fa-pulse\"></i>","finish-icon":"<i class=\"fa fa-check-circle-o fa-fw\"></i>","success-icon":"<i class=\"fa fa-check-circle-o fa-fw\"></i>","failure-icon":"<i class=\"fa fa-exclamation-circle fa-fw\"></i>","file-icon":"<i class=\"fa fa-file-text-o fa-fw\"></i>","left-icon":"<i class=\"fa fa-chevron-left fa-fw\"></i>","right-icon":"<i class=\"fa fa-chevron-right fa-fw\"></i>"},"before-choose":null,"on-choose":null,"on-upload":null,"on-done":null,"on-success":null,"on-error":null,"on-remove":null,"on-clear":null,"on-change":null,"on-msg":null},n={controls:{preview:!0,full:!0}},o={controls:{choose:!1,full:!0,preview:!0,"picture-choose":!0}},p={controls:{choose:!1,full:!0,preview:!0}};b.prototype={init:function(a){const b=this;b.setOption(a),b.fileList=[],b.fileKey=1,b.render(),b.when();const c=[];for(let d=0;d<b.options.data.length;d++)switch(typeof b.options.data[d]){case"string":c.push({url:b.options.data[d],status:j});break;case"object":c.push({url:b.options.data[d].url,status:j,name:b.options.data[d].name});break;default:}0<c.length&&b.push(c)},setOption:function(b){const c=this;let d={};switch(b["list-type"]){case"picture":d=n;case"picture-card":d=o;break;case"picture-placeholder":d=p;break;default:}const e=a.extend(!0,{},m,d,b);return e.multiple||(e.limit=1),"picture-placeholder"===e["list-type"]&&(e.limit=0<e.limit?e.limit:1),e.msg.limit=e.msg.limit.replace(/{limit}/,e.limit),c.options=e,!0},render:function(){const a=this,b=[];a.options.controls.hide||(a.options.controls.choose&&b.push("<button type=\"button\" class=\"ctrl-choose btn "+a.options.controls["choose-style"]+"\">"+a.options.controls["choose-content"]+"</button>"),a.options.controls.display&&b.push("<button type=\"button\" class=\"ctrl-display btn "+a.options.controls["display-style"]+"\" data-display=\"true\">"+a.options.controls["display-hide-content"]+"</button>"),a.options.controls["upload-multiple"]&&b.push("<button type=\"button\" class=\"ctrl-multiple-upload btn "+a.options.controls["upload-multiple-style"]+"\">"+a.options.controls["upload-multiple-content"]+"</button>"),a.options.controls.clear&&b.push("<button type=\"button\" class=\"ctrl-clear btn "+a.options.controls["clear-style"]+"\">"+a.options.controls["clear-content"]+"</button>"));const c=[];switch(c.push("<input class=\"file-input\" type=\"file\" accept=\""+a.options.acceptMime+"\"/>"),0<b.length&&(c.push("<div class=\"controls\">"),c.push(b.join("\n")),c.push("</div>")),a.options["list-type"]){case"picture-card":c.push("<ul class=\"file-list "+a.options["list-type"]+"\"></ul>"),a.options.controls["picture-choose"]&&(c.push("<div class=\"picture-choose ctrl-choose "+a.options.controls["picture-choose-style"]+"\">"),c.push(a.options.controls["picture-choose-content"]),c.push("</div>"));break;case"picture-placeholder":c.push("<ul class=\"file-list "+a.options["list-type"]+"\">");for(let b=1;b<=a.options.limit;b++)c.push("<div class=\"picture-choose ctrl-choose "+a.options.controls["picture-choose-style"]+"\" data-sort=\""+b+"\" data-on=\"false\">"),c.push(a.options.controls["picture-choose-content-list"].length>=b?a.options.controls["picture-choose-content-list"][b-1]:a.options.controls["picture-choose-content"]),c.push("</div>");c.push("</ul>");break;default:c.push("<ul class=\"file-list "+a.options["list-type"]+"\"></ul>");}return a.options.controls.preview&&(c.push("<div class=\"picture-preview\">"),c.push("<ul class=\"picture-wrap\"></ul>"),c.push("<div class=\"picture-preview-close\"><span class=\"picture-pc\"><i class=\"fa fa-remove\"></i></span></div>"),c.push("<div class=\"picture-preview-controls\">"),c.push("<span class=\"ctrl-prev\">"+a.options.icon["left-icon"]+"</span>"),c.push("<span class=\"ctrl-next\">"+a.options.icon["right-icon"]+"</span>"),c.push("</div>"),c.push("</div>")),a.element.addClass("file-upload-wrap").append(c.join("\n")),!0},when:function(){const b=this;b.element.on("click",".ctrl-choose",function(){return"picture-placeholder"===b.options["list-type"]&&(a(".file-list .picture-choose",b.element).attr("data-on",!1),a(this).attr("data-on",!0)),b.choose(),!1}).on("change",".file-input:input[type=\"file\"]",function(){return b._choose(this),!1}).on("click",".ctrl-display",function(){return b.display("false"===a(this).attr("data-display")),!1}).on("click",".ctrl-multiple-upload",function(){return b.uploadMultiple(),!1}).on("click",".ctrl-clear",function(){return b.clear(),!1}).on("click",".ctrl-upload",function(){const c=a(this).closest(".file-item");return b.upload(c.attr("data-key")),!1}).on("click",".ctrl-remove",function(){const c=a(this).closest(".file-item");return b.remove(c.attr("data-key")),!1}).on("click",".ctrl-preview",function(){const c=a(this).closest(".file-item");return b.openPreview(c.attr("data-key")),!1}).on("click",".picture-preview-close",function(){return b.closePreview(),!1}).on("mousedown",".picture-wrap img",function(b){const c=a(this),d=c.position();var e=b.clientX-d.left,f=b.clientY-d.top;return document.onmousemove=function(a){var b=a.clientX-e,d=a.clientY-f;c.css("left",b+"px"),c.css("top",d+"px")},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null},!1}).on("click",".picture-wrap img",function(){return!1}).on("click",".picture-preview",function(){return b.closePreview(),!1}).on("click",".ctrl-prev",function(){const c=a(".picture-preview .picture-wrap li.on",b.element);return(c.removeClass("on"),0===c.prev().length)?(a(".picture-preview .picture-wrap li:last",b.element).addClass("on"),!1):(c.prev().addClass("on"),!1)}).on("click",".ctrl-next",function(){const c=a(".picture-preview .picture-wrap li.on",b.element);return(c.removeClass("on"),0===c.next().length)?(a(".picture-preview .picture-wrap li:first",b.element).addClass("on"),!1):(c.next().addClass("on"),!1)})},openPreview:function(a){var b=Math.round;const c=this,d=c.element.children(".picture-preview"),e=b(d.outerWidth(!0)),f=b(d.outerHeight(!0)),g=[];for(let d=0;d<c.fileList.length;d++){const h=c.fileList[d].url||c.fileList[d].originUrl,i=c.fileList[d].key===a,j=b(c.fileList[d].width),k=b(c.fileList[d].height),l=b((e-j)/2),m=b((f-k)/2);g.push("<li class=\""+(i?"on":"")+"\">"),g.push("<img src=\""+h+"\" style=\"width: "+j+"px; height: "+k+"px; left:"+l+"px; top: "+m+"px\"/>"),g.push("</li>")}d.children(".picture-wrap:first").html(g.join("\n")),d.fadeIn(500)},closePreview:function(){const a=this,b=a.element.children(".picture-preview");b.children(".picture-wrap").html(""),b.fadeOut(500)},choose:function(){const b=this;return b.canAppend(1)?!(null!=b.options["before-choose"]&&a.isFunction(b.options["before-choose"])&&!1===b.options["before-choose"](b.fileList))&&(b.element.children(".file-input:input[type=\"file\"]").click(),!0):(b.msg(c,f,b.options.msg.limit),!1)},_choose:function(b){const d=this;if(!d.canAppend(1))return d.msg(c,f,d.options.msg.limit),a(b).val(""),!1;const e=b.files[0];a(b).val("");const g=e.name,i=g.substring(g.lastIndexOf(".")+1).toLowerCase(),j=window.URL.createObjectURL(e);if(!e.type.match(new RegExp(d.options.accept)))return d.msg(c,f,"\u4E0D\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B"),!1;if(!i.match(new RegExp(d.options.exts)))return d.msg(c,f,"\u4E0D\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B"),!1;if(e.size>d.options.maxSize)return d.msg(c,f,"\u6587\u4EF6\u5927\u5C0F\u8D85\u51FA"),!1;const k=d.createFileObj("",h,g,j,e);return!(null!=d.options["on-choose"]&&a.isFunction(d.options["on-choose"])&&!1===d.options["on-choose"](b,k,d.fileList))&&(d.pushFileElem(k),d.fileList.push(k),d.togglePictureCardChoose(),!0===d.options.auto&&d._upload(k),!0)},display:function(a){const b=this;return a?(b.element.find(".controls .ctrl-display").attr("data-display","true").html(b.options.controls["display-hide-content"]),b.element.children(".file-list").removeClass("hide")):(b.element.find(".controls .ctrl-display").attr("data-display","false").html(b.options.controls["display-show-content"]),b.element.children(".file-list").addClass("hide")),!0},upload:function(a){const b=this,c=b.findFile(a);return c?(b._upload(c),!0):(b.msg(d,g,"\u67E5\u627E\u6587\u4EF6\u5931\u8D25\uFF1Akey = "+a+"["+typeof a+"]"),!1)},uploadMultiple:function(){const a=this,b=a.fileList.length;for(let c=0;c<b;c++)a._upload(a.fileList[c])},_upload:function(b){const c=this;if(![h,l].includes(b.status))return!1;if(null!=c.options["on-upload"]&&a.isFunction(c.options["on-upload"])&&!1===c.options["on-upload"](b,c.fileList))return!1;if(!c.options.url)return c.msg(d,g,"\u670D\u52A1\u7AEF\u4E0A\u4F20\u63A5\u53E3\u672A\u914D\u7F6E"),!1;const e=new FormData;for(let[a,d]of Object.entries(c.options.param))e.append(a,d);e.append("file",b.originData),a.ajax({url:c.options.url,type:"post",cache:!1,data:e,processData:!1,contentType:!1,dataType:"json",headers:c.options.headers||{},beforeSend:function(){c._update(b,{status:i})},complete:function(d){null!=c.options["on-done"]&&a.isFunction(c.options["on-done"])&&c.options["on-done"](d.status,d.responseJSON,b,c.fileList)},success:function(d){return!(null!=c.options["on-success"]&&a.isFunction(c.options["on-success"])&&!1===c.options["on-success"](d,b,c.fileList))&&void c._update(b,{status:k,url:d.url})},error:function(d){return!(null!=c.options["on-error"]&&a.isFunction(c.options["on-error"])&&!1===c.options["on-error"](d.status,d.responseJSON,b,c.fileList))&&void c._update(b,{status:l})}})},update:function(a,b){const c=this,d=c.findFile(a);return d?(c._update(d,b),!0):(c.msg("update",g,"\u67E5\u627E\u6587\u4EF6\u5931\u8D25\uFF1Akey = "+a+"["+typeof a+"]"),!1)},_update:function(a,b){const c=this;let d=!1;if(b.hasOwnProperty("status")){[h,i,j,k,l].includes(b.status)||(b.status=h);const c=[j,k],e=[h,i,l];(c.includes(a.status)&&e.includes(b.status)||e.includes(a.status)&&c.includes(b.status))&&(d=!0),a.status=b.status}return b.hasOwnProperty("name")&&(a.name=b.name),b.hasOwnProperty("url")&&(a.url=b.url),b.hasOwnProperty("originUrl")&&(a.originUrl=b.originUrl),b.hasOwnProperty("originData")&&(a.originData=b.originData),c.refreshItemElem(a),d&&c.change(),!0},push:function(a){const b=this;if(0>=a.length)return b.msg(e,g,"\u6587\u4EF6\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(!b.canAppend(a.length))return b.msg(e,f,b.options.msg.limit),!1;const c=a.length;for(let d=0;d<c;d++){const c=b.createFileObj(a[d].url,a[d].status,a[d].name,a[d].originUrl,a[d].originData);b.pushFileElem(c),b.fileList.push(c)}return b.togglePictureCardChoose(),b.change(),!0},insert:function(a,b){const c=this;if(("number"!=typeof a||0>a||a>c.fileList.length)&&(a=c.fileList.length),!c.canAppend(b.length))return c.msg("insert",f,c.options.msg.limit),!1;for(let d=0,e=b.length;d<e;d++){const e=c.createFileObj(b[d].url,b[d].status,b[d].name,b[d].originUrl,b[d].originData);c.insertFileElem(e,a+d),c.fileList.splice(a+d,0,e)}return c.togglePictureCardChoose(),c.change(),!0},remove:function(b){const c=this,d=c.findFile(b);if(!d)return c.msg("remove",g,"\u67E5\u627E\u6587\u4EF6\u5931\u8D25\uFF1Akey = "+b+"["+typeof b+"]"),!1;if(null!=c.options["on-remove"]&&a.isFunction(c.options["on-remove"])&&!1===c.options["on-remove"](d,c.fileList))return!1;const e=c.findElem(d.key);e&&e.remove();const f=c.fileList.length;for(let a=0;a<f;a++)if(c.fileList[a].key===d.key){c.fileList.splice(a,1),c.togglePictureCardChoose(),c.change();break}return!0},clear:function(){const b=this,c=b.element;return!(null!=b.options["on-clear"]&&a.isFunction(b.options["on-clear"])&&!1===b.options["on-clear"](b.fileList))&&(b.fileList=[],c.children(".file-list").html(""),b.togglePictureCardChoose(),b.change(),!0)},change:function(){const b=this;b.bind(),null!=b.options["on-change"]&&a.isFunction(b.options["on-change"])&&b.options["on-change"](b.fileList)},bind:function(){const b=this;if(!b.options.bindElem)return!0;const c=a(b.options.bindElem);return c&&c.jquery&&c.val(b.toJsonString()),!0},list:function(){const a=this;return a.fileList},val:function(){const a=this;if(1===a.options.limit)return 0<a.fileList.length?a.fileList[0].url:"";const b=[];for(let c=0,d=a.fileList.length;c<d;c++)(a.fileList[c].status===j||a.fileList[c].status===k)&&b.push(a.fileList[c].url);return b},toJsonString:function(){const a=this;return 1===a.options.limit?a.val():JSON.stringify(a.val())},msg:function(b,c,d){const e=this;return null!=e.options["on-msg"]&&a.isFunction(e.options["on-msg"])&&c.match(new RegExp(e.options.subscribeMessage))?e.options["on-msg"](b,c,d,e.fileList):c==="log"?console.log("file-upload-msg",b,c,d):c===f?console.info("file-upload-msg",b,c,d):c==="warn"?console.warn("file-upload-msg",b,c,d):c===g?(console.error("file-upload-msg",b,c,d),alert(d)):(console.log("file-upload-msg",b,c,d),alert(d)),!0},canAppend:function(a){const b=this;return(b.options.multiple||!(1<b.fileList.length+a))&&!(b.options.multiple&&0<b.options.limit&&b.options.limit<b.fileList.length+a)},createFileObj:function(a,b,c,d,e){const f=this;f.fileKey++;const g={key:f.fileKey+"",name:c||"",status:b||h,url:a||"",originUrl:d||"",originData:e||null,width:0,height:0};switch(""===g.name&&(g.name=g.url.substring(g.url.lastIndexOf("/")+1)||"\u6587\u4EF6"+g.key),f.options["list-type"]){case"picture":case"picture-card":case"picture-placeholder":g.width=640,g.height=480,f.getImageSize(g.url||g.originUrl,function(a,b){g.width=a,g.height=b});break;default:}return g},findFile:function(a){const b=this;let c;if("string"==typeof a){const d=b.fileList.length;for(let e=0;e<d;e++)if(b.fileList[e].key===a){c=b.fileList[e];break}}else"number"==typeof a&&0<=a&&a<b.fileList.length&&(c=b.fileList[a]);return c},findElem:function(b){const c=this;return a(".file-item[data-key="+b+"]",c.element)},refresh:function(){const a=this;a.element.children(".file-list").html("");for(let b=0;b<a.fileList.length;b++)a.pushFileElem(a.fileList[b]);return!0},pushFileElem:function(b){const c=this,d=c.createFileElemTpl(b);if("picture-placeholder"===c.options["list-type"]){let b=a(".file-list .picture-choose[data-on=\"true\"]",c.element);return b&&0!==b.length||(b=a(".file-list .picture-choose[data-sort=\""+(c.fileList.length+1)+"\"]",c.element)),a(d).insertBefore(b),!0}return c.element.children(".file-list").append(d),!0},insertFileElem:function(b,c){const d=this;if("number"!=typeof c||0==d.fileList.length||0>c||c>=d.fileList.length)return d.pushFileElem(b);const e=d.createFileElemTpl(b);let f;return"picture-placeholder"===d.options["list-type"]?(f=a(".file-list .picture-choose[data-on=\"true\"]",d.element),(!f||0===f.length)&&(f=a(".file-list .picture-choose[data-sort=\""+(d.fileList.length+1)+"\"]",d.element))):f=d.findElem(d.fileList[c].key),a(e).insertBefore(f),!0},refreshItemElem:function(a){const b=this,c=b.findElem(a.key);return!!c&&(c.removeClass("is-default is-doing is-uploading is-finish is-success is-failure is-warning").addClass(b.getStatusClass(a.status)),c.find(".file-name").attr("href",a.url||a.originUrl),!0===b.options.download&&c.attr("download",a.name||""),c.find(".upload-image").attr("src",a.url||a.originUrl),c.find(".file-status-icon").html(b.getStatusIcon(a.status)),!0)},createFileElemTpl:function(a){const b=this,c=[];switch(c.push("<li class=\"file-item "+b.getStatusClass(a.status)+"\" data-key=\""+a.key+"\">"),b.options["list-type"]){case"picture":c.push("<img class=\"upload-image\" src=\""+(a.originUrl||a.url)+"\">"),c.push("<a class=\"file-name\" "+(b.options.download?"href=\""+a.url+"\" download=\""+a.name+"\"":"")+">"+a.name+"</a>");break;case"picture-card":case"picture-placeholder":c.push("<img class=\"upload-image\" src=\""+(a.originUrl||a.url)+"\">");break;case"text":default:c.push("<a class=\"file-name\" "+(b.options.download?"href=\""+a.url+"\" download=\""+a.name+"\"":"")+"><span class=\"file-type-icon\">"+b.options.icon["file-icon"]+"</span>"+a.name+"</a>");}return c.push("<span class=\"file-status-icon\">"),c.push(b.getStatusIcon(a.status)),c.push("</span>"),c.push("<span class=\"upload-file-control "+(!0===b.options.controls.full?"full":"")+"\">"),!0===b.options.controls.preview&&c.push("<span class=\"file-preview-icon ctrl-preview "+b.options.controls["preview-style"]+"\">"+b.options.controls["preview-content"]+"</span>"),c.push("<span class=\"file-upload-icon ctrl-upload "+b.options.controls["upload-style"]+"\">"+b.options.controls["upload-content"]+"</span>"),c.push("<span class=\"file-remove-icon ctrl-remove "+b.options.controls["remove-style"]+"\">"+b.options.controls["remove-content"]+"</span>"),c.push("</span>"),c.push("</li>"),c.join("\n")},togglePictureCardChoose:function(){const a=this;return"picture-card"===a.options["list-type"]&&!0===a.options.controls["picture-choose"]&&(a.canAppend(1)?a.element.children(".picture-choose").removeClass("hide"):a.element.children(".picture-choose").addClass("hide")),!0},getStatusIcon:function(a){const b=this;switch(a){case h:return b.options.icon["default-icon"];break;case i:return b.options.icon["uploading-icon"];break;case j:return b.options.icon["finish-icon"];break;case k:return b.options.icon["success-icon"];break;case l:return b.options.icon["failure-icon"];break;default:return"";}},getStatusClass:function(a){return a===h?"is-default":a===i?"is-doing":a===j?"is-finish":a===l?"is-failure":a===k?"is-success":"is-warning"},getImageSize:function(a,b){var c=new Image;c.src=a,c.complete?b(c.width,c.height):c.onload=function(){b(c.width,c.height)}}},a.fn.fileUpload=function(c){const d=arguments;[].shift.apply(d);let e;const f=this.each(function(){const f=a(this);let g=f.data("fileUpload");if(!g)f.data("fileUpload",g=new b(f,c));else if("object"==typeof c)for(let a in c)c.hasOwnProperty(a)&&(g.options[a]=c[a]);else"string"==typeof c&&(e=g[c]instanceof Function?g[c].apply(g,d):g.options[c])});return"undefined"==typeof e?f:e}})($);